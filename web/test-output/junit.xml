<?xml version="1.0" encoding="UTF-8" ?>
<testsuites name="vitest tests" tests="20" failures="0" errors="0" time="0.695">
    <testsuite name="__tests__/logger.test.js" timestamp="2025-11-20T19:50:09.072Z" hostname="MKT-ATEECE" tests="2" failures="0" errors="0" skipped="0" time="0.006">
        <testcase classname="__tests__/logger.test.js" name="structured logger &gt; emits JSON with expected fields for info" time="0.004">
        </testcase>
        <testcase classname="__tests__/logger.test.js" name="structured logger &gt; uses stderr for errors" time="0">
        </testcase>
    </testsuite>
    <testsuite name="__tests__/preview-proxy.errors.test.js" timestamp="2025-11-20T19:50:09.074Z" hostname="MKT-ATEECE" tests="5" failures="0" errors="0" skipped="0" time="0.173">
        <testcase classname="__tests__/preview-proxy.errors.test.js" name="preview-proxy error cases &gt; returns 502 when upstream returns non-2xx" time="0.101">
            <system-out>
{&quot;ts&quot;:&quot;2025-11-20T19:50:08.926Z&quot;,&quot;level&quot;:&quot;info&quot;,&quot;message&quot;:&quot;preview-proxy.post_start&quot;,&quot;meta&quot;:{&quot;previewEnabled&quot;:true}}
{&quot;ts&quot;:&quot;2025-11-20T19:50:08.931Z&quot;,&quot;level&quot;:&quot;warn&quot;,&quot;message&quot;:&quot;preview-proxy.upstream_non_2xx&quot;,&quot;meta&quot;:{&quot;status&quot;:500}}
{&quot;ts&quot;:&quot;2025-11-20T19:50:08.931Z&quot;,&quot;level&quot;:&quot;info&quot;,&quot;message&quot;:&quot;metric:preview-proxy.upstream.duration_ms&quot;,&quot;meta&quot;:{&quot;value&quot;:0,&quot;status&quot;:500}}

            </system-out>
        </testcase>
        <testcase classname="__tests__/preview-proxy.errors.test.js" name="preview-proxy error cases &gt; returns 502 on upstream network/fetch error" time="0.015">
            <system-out>
{&quot;ts&quot;:&quot;2025-11-20T19:50:08.942Z&quot;,&quot;level&quot;:&quot;info&quot;,&quot;message&quot;:&quot;preview-proxy.post_start&quot;,&quot;meta&quot;:{&quot;previewEnabled&quot;:true}}

            </system-out>
            <system-err>
{&quot;ts&quot;:&quot;2025-11-20T19:50:08.943Z&quot;,&quot;level&quot;:&quot;error&quot;,&quot;message&quot;:&quot;preview-proxy.upstream_fetch_failed&quot;,&quot;meta&quot;:{&quot;name&quot;:&quot;Error&quot;,&quot;code&quot;:null,&quot;message&quot;:&quot;network failure&quot;}}
{&quot;ts&quot;:&quot;2025-11-20T19:50:08.948Z&quot;,&quot;level&quot;:&quot;error&quot;,&quot;message&quot;:&quot;preview-proxy.upstream_fetch_stack&quot;,&quot;meta&quot;:{&quot;stack&quot;:&quot;Error: network failure\n    at /home/ateece/bapi-headless/web/__tests__/preview-proxy.errors.test.js:47:13\n    at mockCall (file:///home/ateece/bapi-headless/web/node_modules/@vitest/spy/dist/index.js:50:17)\n    at spy (file:///home/ateece/bapi-headless/web/node_modules/tinyspy/dist/index.js:42:80)\n    at POST (/home/ateece/bapi-headless/web/src/app/api/preview-proxy/route.js:94:21)\n    at /home/ateece/bapi-headless/web/__tests__/preview-proxy.errors.test.js:60:17\n    at runTest (file:///home/ateece/bapi-headless/web/node_modules/@vitest/runner/dist/index.js:781:11)\n    at runSuite (file:///home/ateece/bapi-headless/web/node_modules/@vitest/runner/dist/index.js:909:15)\n    at runSuite (file:///home/ateece/bapi-headless/web/node_modules/@vitest/runner/dist/index.js:909:15)\n    at runFiles (file:///home/ateece/bapi-headless/web/node_modules/@vitest/runner/dist/index.js:958:5)\n    at startTests (file:///home/ateece/bapi-headless/web/node_modules/@vitest/runner/dist/index.js:967:3)&quot;}}

            </system-err>
        </testcase>
        <testcase classname="__tests__/preview-proxy.errors.test.js" name="preview-proxy error cases &gt; returns 400 for invalid JSON body" time="0.013">
            <system-out>
{&quot;ts&quot;:&quot;2025-11-20T19:50:08.957Z&quot;,&quot;level&quot;:&quot;info&quot;,&quot;message&quot;:&quot;preview-proxy.post_start&quot;,&quot;meta&quot;:{&quot;previewEnabled&quot;:true}}
{&quot;ts&quot;:&quot;2025-11-20T19:50:08.961Z&quot;,&quot;level&quot;:&quot;warn&quot;,&quot;message&quot;:&quot;preview-proxy.invalid_json&quot;,&quot;meta&quot;:{&quot;error&quot;:&quot;SyntaxError: Unexpected token &apos;o&apos;, \&quot;not-json\&quot; is not valid JSON&quot;}}

            </system-out>
        </testcase>
        <testcase classname="__tests__/preview-proxy.errors.test.js" name="preview-proxy error cases &gt; returns 502 on upstream timeout" time="0.039">
            <system-out>
{&quot;ts&quot;:&quot;2025-11-20T19:50:08.978Z&quot;,&quot;level&quot;:&quot;info&quot;,&quot;message&quot;:&quot;preview-proxy.post_start&quot;,&quot;meta&quot;:{&quot;previewEnabled&quot;:true}}

{&quot;ts&quot;:&quot;2025-11-20T19:50:09.000Z&quot;,&quot;level&quot;:&quot;warn&quot;,&quot;message&quot;:&quot;preview-proxy.upstream_timeout&quot;}

            </system-out>
            <system-err>
{&quot;ts&quot;:&quot;2025-11-20T19:50:09.000Z&quot;,&quot;level&quot;:&quot;error&quot;,&quot;message&quot;:&quot;preview-proxy.upstream_fetch_failed&quot;,&quot;meta&quot;:{&quot;name&quot;:&quot;AbortError&quot;,&quot;code&quot;:null,&quot;message&quot;:&quot;aborted&quot;}}
{&quot;ts&quot;:&quot;2025-11-20T19:50:09.000Z&quot;,&quot;level&quot;:&quot;error&quot;,&quot;message&quot;:&quot;preview-proxy.upstream_fetch_stack&quot;,&quot;meta&quot;:{&quot;stack&quot;:&quot;AbortError: aborted\n    at EventTarget.&lt;anonymous&gt; (/home/ateece/bapi-headless/web/__tests__/preview-proxy.errors.test.js:93:69)\n    at EventTarget.[nodejs.internal.kHybridDispatch] (node:internal/event_target:831:20)\n    at EventTarget.dispatchEvent (node:internal/event_target:766:26)\n    at abortSignal (node:internal/abort_controller:370:10)\n    at AbortController.abort (node:internal/abort_controller:392:5)\n    at Timeout._onTimeout (/home/ateece/bapi-headless/web/src/app/api/preview-proxy/route.js:89:51)\n    at listOnTimeout (node:internal/timers:581:17)\n    at processTimers (node:internal/timers:519:7)&quot;}}

            </system-err>
        </testcase>
        <testcase classname="__tests__/preview-proxy.errors.test.js" name="preview-proxy error cases &gt; returns 401 when secret mismatches" time="0.004">
            <system-out>
{&quot;ts&quot;:&quot;2025-11-20T19:50:09.005Z&quot;,&quot;level&quot;:&quot;info&quot;,&quot;message&quot;:&quot;preview-proxy.post_start&quot;,&quot;meta&quot;:{&quot;previewEnabled&quot;:true}}

            </system-out>
        </testcase>
    </testsuite>
    <testsuite name="__tests__/preview-proxy.extra.test.js" timestamp="2025-11-20T19:50:09.080Z" hostname="MKT-ATEECE" tests="5" failures="0" errors="0" skipped="0" time="0.03">
        <testcase classname="__tests__/preview-proxy.extra.test.js" name="preview-proxy extra coverage &gt; injects Basic Auth header when credentials are provided" time="0.008">
            <system-out>
{&quot;ts&quot;:&quot;2025-11-20T19:50:08.919Z&quot;,&quot;level&quot;:&quot;info&quot;,&quot;message&quot;:&quot;preview-proxy.post_start&quot;,&quot;meta&quot;:{&quot;previewEnabled&quot;:true}}
{&quot;ts&quot;:&quot;2025-11-20T19:50:08.921Z&quot;,&quot;level&quot;:&quot;info&quot;,&quot;message&quot;:&quot;preview-proxy.upstream_auth_set&quot;}
{&quot;ts&quot;:&quot;2025-11-20T19:50:08.922Z&quot;,&quot;level&quot;:&quot;info&quot;,&quot;message&quot;:&quot;metric:preview-proxy.upstream.duration_ms&quot;,&quot;meta&quot;:{&quot;value&quot;:1,&quot;status&quot;:200}}

            </system-out>
        </testcase>
        <testcase classname="__tests__/preview-proxy.extra.test.js" name="preview-proxy extra coverage &gt; uses PREVIEW_CA_PATH to set fetch agent" time="0.003">
            <system-out>
{&quot;ts&quot;:&quot;2025-11-20T19:50:08.925Z&quot;,&quot;level&quot;:&quot;info&quot;,&quot;message&quot;:&quot;preview-proxy.post_start&quot;,&quot;meta&quot;:{&quot;previewEnabled&quot;:true}}
{&quot;ts&quot;:&quot;2025-11-20T19:50:08.925Z&quot;,&quot;level&quot;:&quot;info&quot;,&quot;message&quot;:&quot;preview-proxy.using_preview_ca_path&quot;}
{&quot;ts&quot;:&quot;2025-11-20T19:50:08.926Z&quot;,&quot;level&quot;:&quot;info&quot;,&quot;message&quot;:&quot;metric:preview-proxy.upstream.duration_ms&quot;,&quot;meta&quot;:{&quot;value&quot;:1,&quot;status&quot;:200}}

            </system-out>
        </testcase>
        <testcase classname="__tests__/preview-proxy.extra.test.js" name="preview-proxy extra coverage &gt; returns 400 for invalid JSON body" time="0.002">
            <system-out>
{&quot;ts&quot;:&quot;2025-11-20T19:50:08.927Z&quot;,&quot;level&quot;:&quot;info&quot;,&quot;message&quot;:&quot;preview-proxy.post_start&quot;,&quot;meta&quot;:{&quot;previewEnabled&quot;:true}}
{&quot;ts&quot;:&quot;2025-11-20T19:50:08.927Z&quot;,&quot;level&quot;:&quot;warn&quot;,&quot;message&quot;:&quot;preview-proxy.invalid_json&quot;,&quot;meta&quot;:{&quot;error&quot;:&quot;SyntaxError: Unexpected token &apos;}&apos;, \&quot;}{ not valid json\&quot; is not valid JSON&quot;}}

            </system-out>
        </testcase>
        <testcase classname="__tests__/preview-proxy.extra.test.js" name="preview-proxy extra coverage &gt; times out and returns 502 when upstream fetch is aborted" time="0.011">
            <system-out>
{&quot;ts&quot;:&quot;2025-11-20T19:50:08.930Z&quot;,&quot;level&quot;:&quot;info&quot;,&quot;message&quot;:&quot;preview-proxy.post_start&quot;,&quot;meta&quot;:{&quot;previewEnabled&quot;:true}}

{&quot;ts&quot;:&quot;2025-11-20T19:50:08.939Z&quot;,&quot;level&quot;:&quot;warn&quot;,&quot;message&quot;:&quot;preview-proxy.upstream_timeout&quot;}

            </system-out>
            <system-err>
{&quot;ts&quot;:&quot;2025-11-20T19:50:08.932Z&quot;,&quot;level&quot;:&quot;error&quot;,&quot;message&quot;:&quot;preview-proxy.upstream_fetch_failed&quot;,&quot;meta&quot;:{&quot;name&quot;:&quot;AbortError&quot;,&quot;code&quot;:null,&quot;message&quot;:&quot;The operation was aborted&quot;}}
{&quot;ts&quot;:&quot;2025-11-20T19:50:08.939Z&quot;,&quot;level&quot;:&quot;error&quot;,&quot;message&quot;:&quot;preview-proxy.upstream_fetch_stack&quot;,&quot;meta&quot;:{&quot;stack&quot;:&quot;AbortError: The operation was aborted\n    at EventTarget.&lt;anonymous&gt; (/home/ateece/bapi-headless/web/__tests__/preview-proxy.extra.test.js:111:25)\n    at EventTarget.[nodejs.internal.kHybridDispatch] (node:internal/event_target:831:20)\n    at EventTarget.dispatchEvent (node:internal/event_target:766:26)\n    at abortSignal (node:internal/abort_controller:370:10)\n    at AbortController.abort (node:internal/abort_controller:392:5)\n    at Timeout._onTimeout (/home/ateece/bapi-headless/web/src/app/api/preview-proxy/route.js:89:51)\n    at listOnTimeout (node:internal/timers:581:17)\n    at processTimers (node:internal/timers:519:7)&quot;}}

            </system-err>
        </testcase>
        <testcase classname="__tests__/preview-proxy.extra.test.js" name="preview-proxy extra coverage &gt; normalizes non-2xx upstream responses to 502" time="0.005">
            <system-out>
{&quot;ts&quot;:&quot;2025-11-20T19:50:08.941Z&quot;,&quot;level&quot;:&quot;info&quot;,&quot;message&quot;:&quot;preview-proxy.post_start&quot;,&quot;meta&quot;:{&quot;previewEnabled&quot;:true}}
{&quot;ts&quot;:&quot;2025-11-20T19:50:08.942Z&quot;,&quot;level&quot;:&quot;warn&quot;,&quot;message&quot;:&quot;preview-proxy.upstream_non_2xx&quot;,&quot;meta&quot;:{&quot;status&quot;:500}}
{&quot;ts&quot;:&quot;2025-11-20T19:50:08.942Z&quot;,&quot;level&quot;:&quot;info&quot;,&quot;message&quot;:&quot;metric:preview-proxy.upstream.duration_ms&quot;,&quot;meta&quot;:{&quot;value&quot;:0,&quot;status&quot;:500}}

            </system-out>
        </testcase>
    </testsuite>
    <testsuite name="__tests__/preview-proxy.health.test.js" timestamp="2025-11-20T19:50:09.086Z" hostname="MKT-ATEECE" tests="3" failures="0" errors="0" skipped="0" time="0.013">
        <testcase classname="__tests__/preview-proxy.health.test.js" name="preview-proxy health endpoint &gt; returns 503 when NEXT_PUBLIC_WORDPRESS_GRAPHQL is missing" time="0.009">
        </testcase>
        <testcase classname="__tests__/preview-proxy.health.test.js" name="preview-proxy health endpoint &gt; returns 200 when upstream responds 200" time="0.001">
        </testcase>
        <testcase classname="__tests__/preview-proxy.health.test.js" name="preview-proxy health endpoint &gt; returns 502 when upstream responds non-2xx" time="0.001">
        </testcase>
    </testsuite>
    <testsuite name="__tests__/preview-proxy.post.test.js" timestamp="2025-11-20T19:50:09.087Z" hostname="MKT-ATEECE" tests="1" failures="0" errors="0" skipped="0" time="0.088">
        <testcase classname="__tests__/preview-proxy.post.test.js" name="preview-proxy POST handler &gt; injects Basic Auth when PREVIEW_USER and PREVIEW_APP_PASSWORD are set" time="0.087">
            <system-out>
{&quot;ts&quot;:&quot;2025-11-20T19:50:08.916Z&quot;,&quot;level&quot;:&quot;info&quot;,&quot;message&quot;:&quot;preview-proxy.post_start&quot;,&quot;meta&quot;:{&quot;previewEnabled&quot;:true}}
{&quot;ts&quot;:&quot;2025-11-20T19:50:08.918Z&quot;,&quot;level&quot;:&quot;info&quot;,&quot;message&quot;:&quot;preview-proxy.upstream_auth_set&quot;}
{&quot;ts&quot;:&quot;2025-11-20T19:50:08.919Z&quot;,&quot;level&quot;:&quot;info&quot;,&quot;message&quot;:&quot;metric:preview-proxy.upstream.duration_ms&quot;,&quot;meta&quot;:{&quot;value&quot;:0,&quot;status&quot;:200}}

            </system-out>
        </testcase>
    </testsuite>
    <testsuite name="__tests__/preview-proxy.tls.test.js" timestamp="2025-11-20T19:50:09.089Z" hostname="MKT-ATEECE" tests="1" failures="0" errors="0" skipped="0" time="0.107">
        <testcase classname="__tests__/preview-proxy.tls.test.js" name="preview-proxy TLS / agent selection &gt; uses an insecure agent when PREVIEW_ALLOW_INSECURE=true in dev" time="0.106">
            <system-out>
{&quot;ts&quot;:&quot;2025-11-20T19:50:08.920Z&quot;,&quot;level&quot;:&quot;info&quot;,&quot;message&quot;:&quot;preview-proxy.post_start&quot;,&quot;meta&quot;:{&quot;previewEnabled&quot;:true}}
{&quot;ts&quot;:&quot;2025-11-20T19:50:08.924Z&quot;,&quot;level&quot;:&quot;warn&quot;,&quot;message&quot;:&quot;preview-proxy.preview_allow_insecure&quot;}
{&quot;ts&quot;:&quot;2025-11-20T19:50:08.925Z&quot;,&quot;level&quot;:&quot;info&quot;,&quot;message&quot;:&quot;metric:preview-proxy.upstream.duration_ms&quot;,&quot;meta&quot;:{&quot;value&quot;:1,&quot;status&quot;:200}}

            </system-out>
        </testcase>
    </testsuite>
    <testsuite name="__tests__/preview.integration.test.js" timestamp="2025-11-20T19:50:09.090Z" hostname="MKT-ATEECE" tests="1" failures="0" errors="0" skipped="1" time="0">
        <testcase classname="__tests__/preview.integration.test.js" name="preview proxy integration (optional) &gt; integration test skipped â€” set PREVIEW_INTEGRATION_URL to run" time="0">
            <skipped/>
        </testcase>
    </testsuite>
    <testsuite name="__tests__/preview.test.js" timestamp="2025-11-20T19:50:09.091Z" hostname="MKT-ATEECE" tests="2" failures="0" errors="0" skipped="0" time="0.014">
        <testcase classname="__tests__/preview.test.js" name="preview GET handler &gt; returns 401 when PREVIEW_SECRET unset or does not match" time="0.007">
            <system-out>
{&quot;ts&quot;:&quot;2025-11-20T19:50:08.931Z&quot;,&quot;level&quot;:&quot;debug&quot;,&quot;message&quot;:&quot;preview.secret_presence&quot;,&quot;meta&quot;:{&quot;present&quot;:false,&quot;length&quot;:0}}

            </system-out>
        </testcase>
        <testcase classname="__tests__/preview.test.js" name="preview GET handler &gt; redirects and sets cookies when secret matches" time="0.005">
            <system-out>
{&quot;ts&quot;:&quot;2025-11-20T19:50:08.937Z&quot;,&quot;level&quot;:&quot;debug&quot;,&quot;message&quot;:&quot;preview.secret_presence&quot;,&quot;meta&quot;:{&quot;present&quot;:true,&quot;length&quot;:11}}

            </system-out>
        </testcase>
    </testsuite>
</testsuites>
